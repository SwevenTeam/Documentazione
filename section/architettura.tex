\section{Architettura}
L'architettura del prodotto è suddivisa tra Client e Server, inoltre si utilizzano le \glossario{API Rest} messe a disposizione dall'azienda Imola Informatica.
\subsection{Diagramma delle classi}
	\begin{figure}[H]
	\centering\includegraphics[scale=0.70]{images/diagramma_classi.jpg}
    \caption{Diagramma UML delle classi}
	\end{figure}
\subsection{Client}
Il client è statless cioè non contiene stati ma viene tutto totalmente gestito dal server.
Ad ogni avvio dell'applicazione viene assegnato un nuovo clientID che viene salvato nel localstorage e ad ogni messaggio inviato dall'utente viene aggiunto l'attributo del \textit{clientID} oltre all'\textit{api-key} che è considerata come precondizione. 
Anche solo l'aggiornamento della pagina nel browser comporta l'assegnazione di un nuovo clientID ma se non si è effettuato il logout l'api-key risulterà già inserita e basterà solo inviarla nuovamente.
\subsection{Server}
\subsubsection{App} Classe in cui vengono gestiti gli utenti e si interfaccia direttamente con l'utente, inoltre assegna il nuovo client id ai nuovi utenti.
\subsubsection{Client} Classe che rappresenta la minisessione di ogni utente nel server e ha tutti i dati salvati.
\subsubsection{Server} Classe che contiene la logica utilizzata dal chatbot per poter rispondere correttamente all'input del client tramite l'utilizzo di \textit{Statement\_State}.
\subsubsection{Chatterbot} Classe della libreria esterna scritta in \glossario{Python}. La classe \textit{Chatterbot} e le seguenti \textit{Statement}, \textit{Adapter} fanno parte della libreria.
\subsubsection{Statement} Classe fornita dalla libreria \glossario{Chatterbot} che rappresenta una singola entità, parola o frase che qualcuno può dire.
\subsubsection{LogicAdapter} Classe astratta fornita dalla libreria \glossario{Chatterbot} che permette al programmatore esterno di scrivere nuovi adapter. Dispone dei due metodi base di cui verrà fatto l'\glossario{overriding}:
    \begin{itemize}
        \item can\_process: metodo booleano che controlla tutte le varie condizioni e se tutto okay fa procedere il metodo \textit{process}.
        \item process: controlla ed elabora tutti i dati forniti così da produrre una risposta.
    \end{itemize}
\subsubsection{State} Interfaccia che definisce il contratto di tutti i vari stati e come dato privato si salva l'attuale stato corrente e pubblicamente dispone anche di un metodo per aggiungere informazioni necessarie per completare la richiesta in corso.
\paragraph*{State\_Null} Sottoclasse concreta di \textit{Stato} che simula uno stato nullo, utilizzato quando l'utente non ha effettuato nessuna richiesta.
\subsubsection{Statement\_State} Sottoclasse di Statement, cioè adatta l'adapter alla libreria chatterbot, in più ha lo stato attuale dell'utente, e l'api-key che dimostra l'autenticazione dell'utente che funge come input di ogni adapter.
\subsubsection{Request} Interfaccia che riceve i dati pronti verificandone la completezza e in base all'\textit{adapter} invia la richiesta \glossario{HTTP} alle \glossario{API Rest} di Imola per interagire con i loro servizi e soddisfare la richiesta dell'utente e infine ritorna ad adapter una risposta.
\subsubsection{Login} Classi \textit{Adapter\_Login}, \textit{State\_Login} permettono di effettuare il login
\subsubsection{Logout} Classe \textit{Adapter\_Logout} permette di effettuare il logout.
\subsubsection{Activity} Classi \textit{Adapter\_Activity}, \textit{State\_Activity} e \textit{Request\_Activity} per la funzionalità di consuntivare le ore dedicate ad un progetto compreso le eventuali ore di viaggio.
\subsubsection{Gate} Classi \textit{Adapter\_Gate}, \textit{State\_Gate} e \textit{Request\_Gate} per la funzionalità di apertura cancello
\subsubsection{Project\_Creation} Classi \textit{Adapter\_Project\_Creation}, \textit{State\_Project\_Creation} e \textit{Request\_Project\_Creation}
\subsubsection{Presence} Classi \textit{Adapter\_Presence}, \textit{State\_Presence} e \textit{Request\_Presence} per la funzionalità di registrazione della presenza
\subsubsection{Undo} Classe \textit{Adapter\_Undo} permette di annullare l'operazione in corso e di ricominciare la stessa o un'altra operazione dall'inizio.
\subsection{API Rest Imola Informatica} L'azienda ha fornito delle \glossario{API Rest} che permettono al \glossario{chatbot} di interagire con i loro sistemi aziendali. Sono facilmente consultabili a questo \href{https://apibot4me.imolinfo.it/}{\color{blue} link}.
\subsubsection{Consuntivazione di un attività}
\paragraph{API Url} \hfill \break
/projects/\{code\}/activities/me
\paragraph{Metodo di richiesta \glossario{HTTP}} \hfill \break
POST
\paragraph{Headers \glossario{HTTP}}
\begin{itemize}
    \item \textbf{accept}: application/json;
    \item \textbf{api\_key}: api\_key, per autorizzare le richieste;
    \item \textbf{Content-Type}: application/json.
\end{itemize}
\paragraph{Parametri URL} \hfill \break
\begin{center}
    \renewcommand{\arraystretch}{1.8}
    \begin{tabular}{ |m{10em}|m{4em}|m{20em}| }
        \hline
        \textbf{Nome} & \textbf{Tipo} & \textbf{Descrizione} \\
        \hline
        code & string & rappresenta il codice del progetto di cui fa parte l’attività da rendicontare.\\
        \hline
    \end{tabular}
\end{center}
\paragraph{Parametri Body} \hfill \break
Nel body della richiesta viene passato un array contenente un json con questi parametri
\begin{center}
    \renewcommand{\arraystretch}{1.8}
    \begin{tabular}{ |m{10em}|m{4em}|m{20em}| }
        \hline
        \textbf{Nome} & \textbf{Tipo} & \textbf{Descrizione} \\
        \hline
        date & string & data in cui si è svolta l'attività.\\
        \hline
        billableHours & int & ore fatturabili dell'attività.\\
        \hline
        travelHours & int & ore di viaggio spese per l'attività.\\
        \hline
        billableTravelHours & int & ore di viaggio fatturabili per l'attività.\\
        \hline
        location & string & nome della sede in cui si è svolta l'attività.\\
        \hline
        billable & bool & indica se l'attività è fatturabile.\\
        \hline
        note & string & descrizione dell'attività.\\
        \hline
    \end{tabular}
\end{center}
\paragraph{Risposte}
\begin{center}
    \renewcommand{\arraystretch}{1.8}
    \begin{tabular}{ |m{9em}|m{24em}| }
        \hline
        \textbf{Status code \glossario{HTTP}} & \textbf{Descrizione} \\
        \hline
        204 & indica che la richiesta di consuntivazione è andata a buon fine\\
        \hline
        404 & indica che il codice specificato del progetto non è corretto\\
        \hline
        401 & indica che l'api key non è stata specificata o quella utilizzata non è valida.\\
        \hline
    \end{tabular}
\end{center}
\subsubsection{Apertura del cancello}
\paragraph{API Url} \hfill \break
/locations/\{location\_name\}/devices/\{device\}/status
\paragraph{Metodo di richiesta \glossario{HTTP}} \hfill \break
PUT
\paragraph{Headers \glossario{HTTP}}
\begin{itemize}
    \item \textbf{accept}: application/json;
    \item \textbf{api\_key}: api\_key, per autorizzare le richieste;
    \item \textbf{Content-Type}: application/json.
\end{itemize}
\paragraph{Parametri URL} \hfill \break
\begin{center}
    \renewcommand{\arraystretch}{1.8}
    \begin{tabular}{ |m{10em}|m{4em}|m{20em}| }
        \hline
        \textbf{Nome} & \textbf{Tipo} & \textbf{Descrizione} \\
        \hline
        location\_name & string & sede di cui aprire il cancello.\\
        \hline
        device & string & nome del dispositivo da utilizzare, in questo caso il cancello.\\
        \hline
    \end{tabular}
\end{center}
\paragraph{Parametri Body} \hfill \break
Nel body della richiesta viene passato un json contenente questi parametri
\begin{center}
    \renewcommand{\arraystretch}{1.8}
    \begin{tabular}{ |m{10em}|m{4em}|m{20em}| }
        \hline
        \textbf{Nome} & \textbf{Tipo} & \textbf{Descrizione} \\
        \hline
        status & string & rappresenta il nuovo stato del dispositivo.\\
        \hline
    \end{tabular}
\end{center}
\paragraph{Risposte}
\begin{center}
    \renewcommand{\arraystretch}{1.8}
    \begin{tabular}{ |m{9em}|m{24em}| }
        \hline
        \textbf{Status code \glossario{HTTP}} & \textbf{Descrizione} \\
        \hline
        204 & indica che la richiesta di apertura del cancello è andata a buon fine.\\
        \hline
        404 & indica che la sede di cui aprire il cancello non è valida.\\
        \hline
        401 & indica che l'api key non è stata specificata o quella utilizzata non è valida.\\
        \hline
    \end{tabular}
\end{center}
\subsubsection{Registrazione della presenza}
\paragraph{API Url} \hfill \break
/locations/\{location\_name\}/presence
\paragraph{Metodo di richiesta \glossario{HTTP}} \hfill \break
POST
\paragraph{Headers \glossario{HTTP}}
\begin{itemize}
    \item \textbf{accept}: application/json;
    \item \textbf{api\_key}: api\_key, per autorizzare le richieste;
    \item \textbf{Content-Type}: application/json.
\end{itemize}
\paragraph{Parametri URL} \hfill \break
\begin{center}
    \renewcommand{\arraystretch}{1.8}
    \begin{tabular}{ |m{10em}|m{4em}|m{20em}| }
        \hline
        \textbf{Nome} & \textbf{Tipo} & \textbf{Descrizione} \\
        \hline
        location\_name & string & sede in cui registrare la presenza.\\
        \hline
    \end{tabular}
\end{center}
\paragraph{Risposte}
\begin{center}
    \renewcommand{\arraystretch}{1.8}
    \begin{tabular}{ |m{9em}|m{24em}| }
        \hline
        \textbf{Status code \glossario{HTTP}} & \textbf{Descrizione} \\
        \hline
        200 & indica che la registrazione della presenza è stata effettuata con successo.\\
        \hline
        404 & indica che la sede specificata non è valida.\\
        \hline
        401 & indica che l'api key non è stata specificata o quella utilizzata non è valida.\\
        \hline
    \end{tabular}
\end{center}
\subsubsection{Creazione di un nuovo progetto}
\paragraph{API Url} \hfill \break
/projects
\paragraph{Metodo di richiesta \glossario{HTTP}} \hfill \break
POST
\paragraph{Headers \glossario{HTTP}}
\begin{itemize}
    \item \textbf{accept}: application/json;
    \item \textbf{api\_key}: api\_key, per autorizzare le richieste;
\end{itemize}
\paragraph{Parametri Body} \hfill \break
Nel body della richiesta viene passato un json contenente questi parametri
\begin{center}
    \renewcommand{\arraystretch}{1.8}
    \begin{tabular}{ |m{10em}|m{4em}|m{20em}| }
        \hline
        \textbf{Nome} & \textbf{Tipo} & \textbf{Descrizione} \\
        \hline
        code & string & codice del progetto da creare.\\
        \hline
        detail & string & descrizione del progetto da creare.\\
        \hline
        customer & string & cliente per cui viene creato il progetto.\\
        \hline
        manager & string & manager del progetto da creare.\\
        \hline
        status & string & stato del progetto.\\
        \hline
        area & string & sede in cui svolgere il progetto.\\
        \hline
        startDate & string & data di inizio del progetto.\\
        \hline
        endDate & string & data di fine del progetto.\\
        \hline
    \end{tabular}
\end{center}
\paragraph{Risposte}
\begin{center}
    \renewcommand{\arraystretch}{1.8}
    \begin{tabular}{ |m{9em}|m{24em}| }
        \hline
        \textbf{Status code \glossario{HTTP}} & \textbf{Descrizione} \\
        \hline
        204 & indica che è l'operazione di creazione del progetto è andata a buon fine.\\
        \hline
        400 & indica che almeno uno dei parametri non è stato specificato.\\
        \hline
        401 & indica che l'api key non è stata specificata o quella utilizzata non è valida.\\
        \hline
    \end{tabular}
\end{center}
\subsubsection{Recupero delle sedi}
\paragraph{API Url} \hfill \break
/locations
\paragraph{Metodo di richiesta \glossario{HTTP}} \hfill \break
GET
\paragraph{Headers \glossario{HTTP}}
\begin{itemize}
    \item \textbf{accept}: application/json;
    \item \textbf{api\_key}: api\_key, per autorizzare le richieste;
\end{itemize}
\paragraph{Risposte}
\begin{center}
    \renewcommand{\arraystretch}{1.8}
    \begin{tabular}{ |m{9em}|m{24em}| }
        \hline
        \textbf{Status code \glossario{HTTP}} & \textbf{Descrizione} \\
        \hline
        200 & ritorna una lista contenente le informazioni delle sedi.\\
        \hline
        401 & indica che l'api key non è stata specificata o quella utilizzata non è valida.\\
        \hline
    \end{tabular}
\end{center}
\subsubsection{Recupero della rendicontazione per il progetto corrente}
\paragraph{API Url} \hfill \break
/projects/\{code\}
\paragraph{Metodo di richiesta \glossario{HTTP}} \hfill \break
GET
\paragraph{Headers \glossario{HTTP}}
\begin{itemize}
    \item \textbf{accept}: application/json;
    \item \textbf{api\_key}: api\_key, per autorizzare le richieste;
\end{itemize}
\paragraph{Parametri URL} \hfill \break
\begin{center}
    \renewcommand{\arraystretch}{1.8}
    \begin{tabular}{ |m{10em}|m{4em}|m{20em}| }
        \hline
        \textbf{Nome} & \textbf{Tipo} & \textbf{Descrizione} \\
        \hline
        code & string & codice del progetto corrente.\\
        \hline
    \end{tabular}
\end{center}
\paragraph{Risposte}
\begin{center}
    \renewcommand{\arraystretch}{1.8}
    \begin{tabular}{ |m{9em}|m{24em}| }
        \hline
        \textbf{Status code \glossario{HTTP}} & \textbf{Descrizione} \\
        \hline
        200 & ritorna un json contenente le informazioni per il progetto corrente.\\
        \hline
        401 & indica che l'api key non è stata specificata o quella utilizzata non è valida.\\
        \hline
    \end{tabular}
\end{center}
\newpage
\begin{landscape}
	\begin{figure}[H]
	\centering\includegraphics[width=\linewidth]{images/diagramma_sequenza_server.jpg}
    \caption{Diagramma di sequenza Server}
	\end{figure}
\end{landscape}
\begin{figure}[H]
    \centering\includegraphics[width=\linewidth]{images/diagramma_sequenza_client.jpg}
    \caption{Diagramma di sequenza Client}
\end{figure}
\subsection{Design Pattern}
Front Controller pattern è un pattern architetturale per la progettazione di applicazioni web fornendo un punto di ingresso centralizzato per la gestione delle richieste.
Viene usato il server per gestire le operazioni comuni e poi in base alle specifiche richieste si chiama il rispettivo adapter e state.
\newpage
